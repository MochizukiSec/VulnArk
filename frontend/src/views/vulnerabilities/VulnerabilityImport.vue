<template>
  <div class="vulnerability-import">
    <!-- 页面标题 -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">
          <span class="title-icon"><i class="el-icon-upload2"></i></span>
          漏洞导入
          <span class="title-highlight">工具</span>
        </h1>
        <p class="page-subtitle">批量导入安全漏洞数据，支持多种格式和扫描工具结果</p>
      </div>
      <div class="header-actions">
        <el-button @click="cancel" class="action-btn">
          <i class="el-icon-back"></i> 返回列表
        </el-button>
      </div>
    </div>

    <div class="import-card">
      <el-tabs v-model="activeTab" type="border-card" class="import-tabs">
        <!-- 文件导入 -->
        <el-tab-pane label="文件导入" name="file">
          <div class="tab-content">
            <div class="import-description">
              <div class="description-header">
                <i class="el-icon-document format-icon"></i>
                <h3>支持的文件格式</h3>
              </div>
              <div class="format-grid">
                <div class="format-item">
                  <div class="format-icon-wrapper csv">
                    <i class="el-icon-document"></i>
                  </div>
                  <span>CSV文件 (.csv)</span>
                </div>
                <div class="format-item">
                  <div class="format-icon-wrapper excel">
                    <i class="el-icon-document"></i>
                  </div>
                  <span>Excel文件 (.xlsx, .xls)</span>
                </div>
                <div class="format-item">
                  <div class="format-icon-wrapper json">
                    <i class="el-icon-document"></i>
                  </div>
                  <span>JSON文件 (.json)</span>
                </div>
                <div class="format-item">
                  <div class="format-icon-wrapper xml">
                    <i class="el-icon-document"></i>
                  </div>
                  <span>XML文件 (.xml)</span>
                </div>
              </div>
              <p class="format-notice">请确保文件包含必要的字段，如漏洞标题、严重程度、描述等。
                <a href="#" @click.prevent="downloadTemplate" class="download-link">
                  <i class="el-icon-download"></i> 下载模板文件
                </a>
              </p>
              <el-alert
                type="warning"
                show-icon
                :closable="false"
                class="import-alert"
              >
                <p>导入大量数据可能需要一些时间，请耐心等待并不要刷新页面。</p>
              </el-alert>
            </div>

            <el-upload
              class="upload-area"
              drag
              action="/api/vulnerabilities/import"
              :auto-upload="false"
              :on-change="handleFileChange"
              :on-success="handleImportSuccess"
              :on-error="handleImportError"
              :before-upload="beforeImport"
              :file-list="fileList"
              :limit="1"
            >
              <i class="el-icon-upload"></i>
              <div class="el-upload__text">将文件拖到此处，或<em>点击上传</em></div>
              <template #tip>
                <div class="el-upload__tip">支持CSV、Excel、JSON和XML文件，文件大小不超过10MB</div>
              </template>
            </el-upload>

            <div class="import-options">
              <div class="options-header">
                <i class="el-icon-setting"></i>
                <h3>导入选项</h3>
              </div>
              <el-form :model="importOptions" label-width="180px">
                <el-form-item label="导入重复项时">
                  <el-radio-group v-model="importOptions.duplicateStrategy">
                    <el-radio label="skip">跳过重复项</el-radio>
                    <el-radio label="update">更新重复项</el-radio>
                    <el-radio label="create_new">创建为新记录</el-radio>
                  </el-radio-group>
                </el-form-item>
                
                <el-form-item label="默认严重程度">
                  <el-select v-model="importOptions.defaultSeverity" placeholder="选择默认严重程度">
                    <el-option label="未指定" value="" />
                    <el-option label="严重" value="critical">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot critical"></span>
                          <span>严重</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="高危" value="high">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot high"></span>
                          <span>高危</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="中危" value="medium">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot medium"></span>
                          <span>中危</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="低危" value="low">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot low"></span>
                          <span>低危</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="信息" value="info">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot info"></span>
                          <span>信息</span>
                        </div>
                      </template>
                    </el-option>
                  </el-select>
                  <div class="option-description">当导入数据未指定严重程度时使用</div>
                </el-form-item>
                
                <el-form-item label="默认状态">
                  <el-select v-model="importOptions.defaultStatus" placeholder="选择默认状态">
                    <el-option label="开放" value="open" />
                    <el-option label="处理中" value="in_progress" />
                    <el-option label="已解决" value="resolved" />
                    <el-option label="已关闭" value="closed" />
                    <el-option label="误报" value="false_positive" />
                  </el-select>
                  <div class="option-description">当导入数据未指定状态时使用</div>
                </el-form-item>
                
                <el-form-item label="发送通知">
                  <el-switch v-model="importOptions.sendNotifications" />
                  <div class="option-description">完成导入后是否发送通知</div>
                </el-form-item>
              </el-form>
            </div>
          </div>

          <div class="import-actions">
            <el-button @click="cancel" class="cancel-btn">取消</el-button>
            <el-button type="primary" @click="startImport" :loading="importing" :disabled="fileList.length === 0" class="import-btn">
              <i class="el-icon-upload"></i> 开始导入
            </el-button>
          </div>
        </el-tab-pane>

        <!-- 扫描结果导入 -->
        <el-tab-pane label="扫描结果导入" name="scan">
          <div class="tab-content">
            <div class="import-description">
              <div class="description-header">
                <i class="el-icon-monitor format-icon"></i>
                <h3>支持的扫描工具</h3>
              </div>
              <div class="scanner-grid">
                <div class="scanner-item" v-for="(scanner, index) in scanners" :key="index">
                  <div class="scanner-icon-wrapper" :class="scanner.class">
                    <i class="el-icon-cpu"></i>
                  </div>
                  <span>{{ scanner.name }}</span>
                  <span class="scanner-format">{{ scanner.format }}</span>
                </div>
              </div>
              <p class="format-notice">系统会自动解析扫描工具的报告格式，并将漏洞信息导入到平台中。</p>
              <el-alert
                type="info"
                show-icon
                :closable="false"
                class="import-alert"
              >
                <p>导入后请检查数据准确性，不同扫描工具的数据格式可能略有差异。</p>
              </el-alert>
            </div>

            <el-upload
              class="upload-area"
              drag
              action="/api/vulnerabilities/import/scan"
              :auto-upload="false"
              :on-change="handleScanFileChange"
              :on-success="handleImportSuccess"
              :on-error="handleImportError"
              :before-upload="beforeImport"
              :file-list="scanFileList"
              :limit="1"
            >
              <i class="el-icon-upload"></i>
              <div class="el-upload__text">将扫描报告文件拖到此处，或<em>点击上传</em></div>
              <template #tip>
                <div class="el-upload__tip">支持各种扫描工具生成的报告文件，文件大小不超过50MB</div>
              </template>
            </el-upload>

            <div class="import-options">
              <div class="options-header">
                <i class="el-icon-setting"></i>
                <h3>导入选项</h3>
              </div>
              <el-form :model="scanImportOptions" label-width="180px">
                <el-form-item label="扫描工具类型">
                  <el-select v-model="scanImportOptions.scannerType" placeholder="选择扫描工具类型">
                    <el-option label="自动检测" value="auto" />
                    <el-option label="Nessus" value="nessus" />
                    <el-option label="OpenVAS/Greenbone" value="openvas" />
                    <el-option label="OWASP ZAP" value="zap" />
                    <el-option label="Qualys" value="qualys" />
                    <el-option label="Acunetix" value="acunetix" />
                    <el-option label="Burp Suite" value="burp" />
                  </el-select>
                  <div class="option-description">通常情况下可以使用自动检测</div>
                </el-form-item>
                
                <el-form-item label="最低严重程度">
                  <el-select v-model="scanImportOptions.minimumSeverity" placeholder="选择最低严重程度">
                    <el-option label="全部导入" value="" />
                    <el-option label="严重" value="critical">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot critical"></span>
                          <span>严重</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="高危" value="high">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot high"></span>
                          <span>高危</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="中危" value="medium">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot medium"></span>
                          <span>中危</span>
                        </div>
                      </template>
                    </el-option>
                    <el-option label="低危" value="low">
                      <template #default>
                        <div class="severity-option">
                          <span class="severity-dot low"></span>
                          <span>低危</span>
                        </div>
                      </template>
                    </el-option>
                  </el-select>
                  <div class="option-description">仅导入选定严重程度及以上的漏洞</div>
                </el-form-item>
                
                <el-form-item label="导入重复项时">
                  <el-radio-group v-model="scanImportOptions.duplicateStrategy">
                    <el-radio label="skip">跳过重复项</el-radio>
                    <el-radio label="update">更新重复项</el-radio>
                    <el-radio label="create_new">创建为新记录</el-radio>
                  </el-radio-group>
                </el-form-item>
                
                <el-form-item label="发送通知">
                  <el-switch v-model="scanImportOptions.sendNotifications" />
                  <div class="option-description">完成导入后是否发送通知</div>
                </el-form-item>
              </el-form>
            </div>
          </div>

          <div class="import-actions">
            <el-button @click="cancel" class="cancel-btn">取消</el-button>
            <el-button type="primary" @click="startScanImport" :loading="importing" :disabled="scanFileList.length === 0" class="import-btn">
              <i class="el-icon-upload"></i> 开始导入
            </el-button>
          </div>
        </el-tab-pane>
      </el-tabs>
    </div>

    <!-- 导入进度对话框 -->
    <el-dialog
      title="导入进度"
      v-model="progressDialogVisible"
      :close-on-click-modal="false"
      :close-on-press-escape="false"
      :show-close="false"
      width="500px"
      class="progress-dialog"
    >
      <div class="progress-dialog-content">
        <el-progress 
          :percentage="importProgress" 
          :status="importProgress === 100 ? 'success' : ''"
          :stroke-width="10"
          class="import-progress"
        ></el-progress>
        <div class="progress-info">
          <p>{{ progressMessage }}</p>
          <div v-if="importCompleted" class="import-summary">
            <div class="summary-item">
              <div class="summary-label">成功导入：</div>
              <div class="summary-value success">{{ importResults.successful }}</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">重复跳过：</div>
              <div class="summary-value skipped">{{ importResults.duplicates }}</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">导入失败：</div>
              <div class="summary-value error">{{ importResults.failed }}</div>
            </div>
          </div>
        </div>
      </div>
      <template #footer>
        <span class="dialog-footer">
          <el-button 
            v-if="importCompleted" 
            type="primary" 
            @click="closeProgressDialog"
          >
            关闭
          </el-button>
          <el-button 
            v-if="importProgress < 100 && !importing" 
            type="danger" 
            @click="cancelImport"
          >
            取消导入
          </el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>

<script>
import { ref, reactive } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useStore } from 'vuex'

export default {
  name: 'VulnerabilityImport',
  
  setup() {
    const router = useRouter()
    const store = useStore()
    const activeTab = ref('file')
    const fileList = ref([])
    const scanFileList = ref([])
    const importing = ref(false)
    
    // 进度对话框相关
    const progressDialogVisible = ref(false)
    const importProgress = ref(0)
    const progressMessage = ref('准备导入...')
    const importCompleted = ref(false)
    const importResults = reactive({
      successful: 0,
      duplicates: 0,
      failed: 0
    })

    // 扫描工具列表
    const scanners = [
      { name: 'Nessus', format: '.nessus', class: 'nessus' },
      { name: 'OpenVAS/Greenbone', format: '.xml', class: 'openvas' },
      { name: 'OWASP ZAP', format: '.xml, .json', class: 'zap' },
      { name: 'Qualys', format: '.xml', class: 'qualys' },
      { name: 'Acunetix', format: '.xml', class: 'acunetix' },
      { name: 'Burp Suite', format: '.xml', class: 'burp' }
    ]
    
    // 文件导入选项
    const importOptions = reactive({
      duplicateStrategy: 'skip',
      defaultSeverity: 'medium',
      defaultStatus: 'open',
      sendNotifications: true
    })
    
    // 扫描结果导入选项
    const scanImportOptions = reactive({
      scannerType: 'auto',
      minimumSeverity: '',
      duplicateStrategy: 'skip',
      sendNotifications: true
    })
    
    // 处理文件变化
    const handleFileChange = (file) => {
      fileList.value = [file]
    }
    
    // 处理扫描文件变化
    const handleScanFileChange = (file) => {
      scanFileList.value = [file]
    }
    
    // 导入前检查
    const beforeImport = (file) => {
      const fileSize = file.size / 1024 / 1024
      if (fileSize > 50) {
        ElMessage.error('文件大小不能超过50MB')
        return false
      }
      return true
    }
    
    // 下载模板文件
    const downloadTemplate = () => {
      // 这里应该是调用后端API下载模板
      ElMessage.info('模板文件下载功能尚未实现')
    }
    
    // 开始导入
    const startImport = () => {
      if (fileList.value.length === 0) {
        ElMessage.warning('请选择要导入的文件')
        return
      }
      
      ElMessageBox.confirm(
        '确定要开始导入文件吗？根据数据量大小，这可能需要一些时间。',
        '开始导入',
        {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'info'
        }
      ).then(() => {
        importing.value = true
        progressDialogVisible.value = true
        importProgress.value = 0
        progressMessage.value = '正在解析文件...'
        
        // 模拟导入进度
        simulateImportProgress()
        
        // 这里应该提交表单，触发文件上传
        setTimeout(() => {
          const uploadInstance = document.querySelector('.upload-area .el-upload').querySelector('input[type=file]')
          if (uploadInstance && uploadInstance.files.length > 0) {
            // 触发自动上传
          }
        }, 500)
      }).catch(() => {
        // 用户取消导入
      })
    }
    
    // 开始扫描结果导入
    const startScanImport = () => {
      if (scanFileList.value.length === 0) {
        ElMessage.warning('请选择扫描结果文件')
        return
      }
      
      ElMessageBox.confirm(
        '确定要开始导入扫描结果吗？根据数据量大小，这可能需要一些时间。',
        '开始导入',
        {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'info'
        }
      ).then(() => {
        importing.value = true
        progressDialogVisible.value = true
        importProgress.value = 0
        progressMessage.value = '正在解析扫描结果...'
        
        // 模拟导入进度
        simulateImportProgress()
        
        // 这里应该提交表单，触发文件上传
        setTimeout(() => {
          const uploadInstance = document.querySelector('.upload-area .el-upload').querySelector('input[type=file]')
          if (uploadInstance && uploadInstance.files.length > 0) {
            // 触发自动上传
          }
        }, 500)
      }).catch(() => {
        // 用户取消导入
      })
    }
    
    // 模拟导入进度
    const simulateImportProgress = () => {
      let currentProgress = 0
      const interval = setInterval(() => {
        currentProgress += Math.random() * 10
        if (currentProgress >= 90) {
          currentProgress = 90
          clearInterval(interval)
          progressMessage.value = '即将完成...'
        }
        importProgress.value = Math.floor(currentProgress)
      }, 800)
      
      // 模拟导入完成
      setTimeout(() => {
        importProgress.value = 100
        importing.value = false
        progressMessage.value = '导入完成！'
        importCompleted.value = true
        
        // 模拟导入结果
        importResults.successful = Math.floor(Math.random() * 50) + 20
        importResults.duplicates = Math.floor(Math.random() * 10)
        importResults.failed = Math.floor(Math.random() * 5)
      }, 8000)
    }
    
    // 处理导入成功
    const handleImportSuccess = (response) => {
      importing.value = false
      importProgress.value = 100
      progressMessage.value = '导入完成！'
      importCompleted.value = true
      
      // 更新导入统计信息
      if (response && response.data && response.data.stats) {
        Object.assign(importResults, response.data.stats)
      }
      
      // 刷新仪表盘数据
      store.dispatch('dashboard/fetchDashboardData')
      
      ElMessage.success('导入成功')
    }
    
    // 处理导入错误
    const handleImportError = (error) => {
      importing.value = false
      ElMessage.error('导入失败: ' + (error.message || '未知错误'))
      progressDialogVisible.value = false
    }
    
    // 关闭进度对话框
    const closeProgressDialog = () => {
      progressDialogVisible.value = false
      importCompleted.value = false
      
      // 成功导入后跳转到漏洞列表
      if (importProgress.value === 100) {
        router.push('/vulnerabilities')
      }
    }
    
    // 取消导入
    const cancelImport = () => {
      ElMessageBox.confirm(
        '确定要取消当前导入操作吗？已导入的数据将不会回滚。',
        '取消导入',
        {
          confirmButtonText: '确定',
          cancelButtonText: '继续导入',
          type: 'warning'
        }
      ).then(() => {
        importing.value = false
        progressDialogVisible.value = false
        ElMessage.info('导入已取消')
      }).catch(() => {
        // 用户选择继续导入
      })
    }
    
    // 返回上一页
    const cancel = () => {
      router.push('/vulnerabilities')
    }
    
    return {
      activeTab,
      fileList,
      scanFileList,
      importing,
      importOptions,
      scanImportOptions,
      progressDialogVisible,
      importProgress,
      progressMessage,
      importCompleted,
      importResults,
      scanners,
      handleFileChange,
      handleScanFileChange,
      beforeImport,
      startImport,
      startScanImport,
      handleImportSuccess,
      handleImportError,
      downloadTemplate,
      closeProgressDialog,
      cancelImport,
      cancel
    }
  }
}
</script>

<style lang="scss" scoped>
.vulnerability-import {
  padding: 24px;
  animation: fadeIn 0.6s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  
  .header-content {
    flex: 1;
  }
  
  .page-title {
    font-size: 28px;
    font-weight: 600;
    margin: 0 0 8px 0;
    display: flex;
    align-items: center;
    color: #303133;
    
    .title-icon {
      margin-right: 12px;
      font-size: 28px;
      color: #409EFF;
    }
    
    .title-highlight {
      background: linear-gradient(120deg, #409EFF, #53A8FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-left: 8px;
      font-weight: 700;
    }
  }
  
  .page-subtitle {
    color: #606266;
    font-size: 16px;
    margin: 0;
  }
  
  .header-actions {
    display: flex;
    gap: 12px;
    
    .action-btn {
      border-radius: 8px;
      padding: 10px 20px;
      font-weight: 500;
      transition: all 0.3s;
      
      i {
        margin-right: 6px;
      }
      
      &:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
    }
  }
}

.import-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  
  &:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
  }
  
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #409EFF, #53A8FF);
  }
  
  .import-tabs {
    border: none;
    
    :deep(.el-tabs__content) {
      padding: 24px;
    }
    
    :deep(.el-tabs__header) {
      margin-bottom: 0;
      background: #f5f7fa;
      border-bottom: 1px solid #e4e7ed;
    }
    
    :deep(.el-tabs__nav) {
      border: none;
    }
    
    :deep(.el-tabs__item) {
      height: 50px;
      line-height: 50px;
      font-size: 16px;
      font-weight: 500;
      color: #606266;
      transition: all 0.3s;
      
      &.is-active {
        color: #409EFF;
        font-weight: 600;
      }
      
      &:hover {
        color: #409EFF;
      }
    }
  }
}

.tab-content {
  margin-bottom: 20px;
}

.import-description {
  margin-bottom: 30px;
  
  .description-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    
    i {
      font-size: 24px;
      color: #409EFF;
      margin-right: 12px;
    }
    
    h3 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      color: #303133;
    }
  }
  
  p {
    margin: 16px 0;
    color: #606266;
    line-height: 1.6;
  }
  
  ul {
    margin: 16px 0;
    padding-left: 20px;
    
    li {
      margin-bottom: 8px;
      color: #606266;
    }
  }
  
  .format-notice {
    color: #606266;
    line-height: 1.6;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
  }
  
  .download-link {
    color: #409EFF;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s;
    display: inline-flex;
    align-items: center;
    
    i {
      margin-right: 4px;
    }
    
    &:hover {
      color: #66b1ff;
      text-decoration: underline;
    }
  }
  
  .import-alert {
    margin-top: 20px;
    border-radius: 8px;
    
    :deep(.el-alert__content) {
      p {
        margin: 0;
      }
    }
  }
}

.format-grid, .scanner-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  margin: 20px 0;
  
  .format-item, .scanner-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 16px;
    border-radius: 8px;
    background: #f5f7fa;
    transition: all 0.3s;
    
    &:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .format-icon-wrapper, .scanner-icon-wrapper {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(64, 158, 255, 0.1);
      color: #409EFF;
      font-size: 24px;
      
      &.csv {
        background: rgba(76, 175, 80, 0.1);
        color: #4CAF50;
      }
      
      &.excel {
        background: rgba(33, 150, 243, 0.1);
        color: #2196F3;
      }
      
      &.json {
        background: rgba(255, 152, 0, 0.1);
        color: #FF9800;
      }
      
      &.xml {
        background: rgba(156, 39, 176, 0.1);
        color: #9C27B0;
      }
      
      &.nessus {
        background: rgba(244, 67, 54, 0.1);
        color: #F44336;
      }
      
      &.openvas {
        background: rgba(76, 175, 80, 0.1);
        color: #4CAF50;
      }
      
      &.zap {
        background: rgba(33, 150, 243, 0.1);
        color: #2196F3;
      }
      
      &.qualys {
        background: rgba(255, 152, 0, 0.1);
        color: #FF9800;
      }
      
      &.acunetix {
        background: rgba(156, 39, 176, 0.1);
        color: #9C27B0;
      }
      
      &.burp {
        background: rgba(233, 30, 99, 0.1);
        color: #E91E63;
      }
    }
    
    span {
      color: #303133;
      font-weight: 500;
      text-align: center;
    }
    
    .scanner-format {
      color: #909399;
      font-size: 12px;
      font-weight: normal;
    }
  }
}

.upload-area {
  margin-bottom: 30px;
  
  :deep(.el-upload-dragger) {
    width: 100%;
    height: 180px;
    border: 2px dashed #d9d9d9;
    border-radius: 8px;
    background: #f5f7fa;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    
    &:hover {
      border-color: #409EFF;
      background: rgba(64, 158, 255, 0.05);
    }
    
    i {
      font-size: 48px;
      color: #c0c4cc;
      margin-bottom: 16px;
      transition: all 0.3s;
    }
    
    &:hover i {
      color: #409EFF;
    }
    
    .el-upload__text {
      font-size: 16px;
      color: #606266;
      
      em {
        color: #409EFF;
        font-style: normal;
        font-weight: 500;
      }
    }
  }
  
  :deep(.el-upload__tip) {
    color: #909399;
    font-size: 13px;
    margin-top: 12px;
    text-align: center;
  }
}

.import-options {
  background: #f9fbfd;
  border-radius: 8px;
  padding: 20px;
  
  .options-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    
    i {
      font-size: 20px;
      color: #409EFF;
      margin-right: 8px;
    }
    
    h3 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      color: #303133;
    }
  }
  
  :deep(.el-form-item__label) {
    padding-bottom: 8px;
    font-weight: 500;
    color: #606266;
  }
  
  :deep(.el-input__inner), :deep(.el-textarea__inner) {
    border-radius: 8px;
    transition: all 0.3s;
    
    &:focus {
      box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.2);
    }
  }
  
  .option-description {
    color: #909399;
    font-size: 12px;
    margin-top: 4px;
  }
}

.severity-option {
  display: flex;
  align-items: center;
  
  .severity-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    margin-right: 8px;
    
    &.critical {
      background-color: #F44336;
    }
    
    &.high {
      background-color: #FF9800;
    }
    
    &.medium {
      background-color: #FFEB3B;
    }
    
    &.low {
      background-color: #4CAF50;
    }
    
    &.info {
      background-color: #2196F3;
    }
  }
}

.import-actions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding-top: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.05);
  margin-top: 20px;
  
  .cancel-btn {
    border-radius: 8px;
    padding: 10px 20px;
  }
  
  .import-btn {
    border-radius: 8px;
    padding: 10px 24px;
    font-weight: 500;
    transition: all 0.3s;
    min-width: 120px;
    
    i {
      margin-right: 6px;
    }
    
    &:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(64, 158, 255, 0.2);
    }
  }
}

.progress-dialog {
  :deep(.el-dialog__header) {
    padding: 20px;
    margin: 0;
    background: #f5f7fa;
    border-bottom: 1px solid #e4e7ed;
    
    .el-dialog__title {
      font-size: 18px;
      font-weight: 600;
      color: #303133;
    }
  }
  
  :deep(.el-dialog__body) {
    padding: 24px;
  }
  
  :deep(.el-dialog__footer) {
    padding: 16px 24px;
    border-top: 1px solid #e4e7ed;
  }
}

.progress-dialog-content {
  .import-progress {
    margin-bottom: 24px;
    
    :deep(.el-progress-bar__outer) {
      border-radius: 8px;
      background: #ebeef5;
    }
    
    :deep(.el-progress-bar__inner) {
      border-radius: 8px;
      background: linear-gradient(90deg, #409EFF, #53A8FF);
    }
  }
  
  .progress-info {
    text-align: center;
    
    p {
      margin: 0 0 16px 0;
      color: #606266;
      font-size: 16px;
    }
  }
  
  .import-summary {
    display: flex;
    justify-content: center;
    gap: 24px;
    margin-top: 24px;
    
    .summary-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      
      .summary-label {
        color: #909399;
        font-size: 14px;
        margin-bottom: 8px;
      }
      
      .summary-value {
        font-size: 24px;
        font-weight: 600;
        
        &.success {
          color: #67C23A;
        }
        
        &.skipped {
          color: #E6A23C;
        }
        
        &.error {
          color: #F56C6C;
        }
      }
    }
  }
}

// 响应式调整
@media (max-width: 768px) {
  .vulnerability-import {
    padding: 16px;
  }
  
  .page-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
    
    .header-actions {
      align-self: flex-start;
    }
    
    .page-title {
      font-size: 24px;
      
      .title-icon {
        font-size: 24px;
      }
    }
    
    .page-subtitle {
      font-size: 14px;
    }
  }
  
  .import-card {
    .import-tabs {
      :deep(.el-tabs__content) {
        padding: 16px;
      }
      
      :deep(.el-tabs__item) {
        height: 40px;
        line-height: 40px;
        font-size: 14px;
      }
    }
  }
  
  .format-grid, .scanner-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .import-options {
    padding: 16px;
    
    :deep(.el-form-item__label) {
      width: 100% !important;
      text-align: left;
      margin-bottom: 8px;
    }
  }
  
  .import-actions {
    flex-direction: column;
    
    .el-button {
      width: 100%;
    }
  }
}
</style> 