{"ast":null,"code":"import { reactive, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport { ElMessageBox, ElMessage } from 'element-plus';\nexport default {\n  name: 'VulnerabilityList',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const loading = computed(() => store.getters['vulnerability/isLoading']);\n\n    // 搜索参数\n    const searchParams = reactive({\n      severity: '',\n      status: '',\n      assignedTo: '',\n      searchTerm: '',\n      sortBy: 'createdAt',\n      sortOrder: 'desc',\n      page: 1,\n      perPage: 10\n    });\n\n    // 获取漏洞列表和分页信息\n    const vulnerabilities = computed(() => store.getters['vulnerability/allVulnerabilities']);\n    const pagination = computed(() => store.getters['vulnerability/pagination']);\n\n    // 搜索方法\n    const search = () => {\n      store.dispatch('vulnerability/updateSearchParams', {\n        ...searchParams\n      });\n    };\n\n    // 重置搜索条件\n    const resetSearch = () => {\n      Object.assign(searchParams, {\n        severity: '',\n        status: '',\n        assignedTo: '',\n        searchTerm: '',\n        sortBy: 'createdAt',\n        sortOrder: 'desc',\n        page: 1\n      });\n      search();\n    };\n\n    // 处理表格排序变化\n    const handleSortChange = ({\n      prop,\n      order\n    }) => {\n      if (!prop) return;\n\n      // 映射前端属性名到后端字段名\n      const fieldMapping = {\n        'title': 'title',\n        'severity': 'severity',\n        'status': 'status',\n        'cvss': 'cvss',\n        'discoveredAt': 'discoveredAt',\n        'createdAt': 'createdAt'\n      };\n\n      // 转换排序字段和顺序\n      const sortBy = fieldMapping[prop] || 'createdAt';\n      const sortOrder = order === 'ascending' ? 'asc' : 'desc';\n\n      // 更新搜索参数并重新获取数据\n      store.dispatch('vulnerability/updateSearchParams', {\n        sortBy,\n        sortOrder\n      });\n    };\n\n    // 处理分页大小变化\n    const handleSizeChange = newSize => {\n      store.dispatch('vulnerability/updateSearchParams', {\n        perPage: newSize\n      });\n    };\n\n    // 处理页码变化\n    const handleCurrentChange = newPage => {\n      store.dispatch('vulnerability/updateSearchParams', {\n        page: newPage\n      });\n    };\n\n    // 查看漏洞详情\n    const viewDetails = id => {\n      router.push(`/vulnerabilities/${id}`);\n    };\n\n    // 跳转到创建页面\n    const goToCreate = () => {\n      router.push('/vulnerabilities/create');\n    };\n\n    // 跳转到导入页面\n    const goToImport = () => {\n      router.push('/vulnerabilities/import');\n    };\n\n    // 确认删除对话框\n    const confirmDelete = row => {\n      ElMessageBox.confirm(`确定要删除漏洞 \"${row.title}\" 吗？`, '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        // 执行删除操作\n        deleteVulnerability(row.id);\n      }).catch(() => {\n        // 取消删除\n        ElMessage({\n          type: 'info',\n          message: '已取消删除'\n        });\n      });\n    };\n\n    // 删除漏洞\n    const deleteVulnerability = async id => {\n      try {\n        await store.dispatch('vulnerability/deleteVulnerability', id);\n        ElMessage({\n          type: 'success',\n          message: '删除成功'\n        });\n      } catch (error) {\n        ElMessage({\n          type: 'error',\n          message: '删除失败: ' + (error.message || '未知错误')\n        });\n      }\n    };\n\n    // 根据CVSS评分获取颜色类\n    const getCvssClass = score => {\n      if (!score) return '';\n      if (score >= 9.0) return 'critical';\n      if (score >= 7.0) return 'high';\n      if (score >= 4.0) return 'medium';\n      if (score >= 0.1) return 'low';\n      return '';\n    };\n\n    // 组件挂载时获取数据\n    onMounted(() => {\n      store.dispatch('vulnerability/fetchVulnerabilities');\n    });\n    return {\n      loading,\n      searchParams,\n      vulnerabilities,\n      pagination,\n      search,\n      resetSearch,\n      handleSortChange,\n      handleSizeChange,\n      handleCurrentChange,\n      viewDetails,\n      goToCreate,\n      goToImport,\n      confirmDelete,\n      getCvssClass\n    };\n  }\n};","map":{"version":3,"names":["reactive","computed","onMounted","useStore","useRouter","ElMessageBox","ElMessage","name","setup","store","router","loading","getters","searchParams","severity","status","assignedTo","searchTerm","sortBy","sortOrder","page","perPage","vulnerabilities","pagination","search","dispatch","resetSearch","Object","assign","handleSortChange","prop","order","fieldMapping","handleSizeChange","newSize","handleCurrentChange","newPage","viewDetails","id","push","goToCreate","goToImport","confirmDelete","row","confirm","title","confirmButtonText","cancelButtonText","type","then","deleteVulnerability","catch","message","error","getCvssClass","score"],"sources":["/Users/yue/Desktop/vuln-Management/frontend/src/views/vulnerabilities/VulnerabilityList.vue"],"sourcesContent":["<template>\n  <div class=\"vulnerability-list\">\n    <div class=\"page-header\">\n      <div>\n        <h1 class=\"page-title\">漏洞列表</h1>\n        <p class=\"page-subtitle\">查看和管理所有漏洞信息</p>\n      </div>\n      <div class=\"header-actions\">\n        <el-button type=\"primary\" @click=\"goToCreate\">\n          添加漏洞\n        </el-button>\n        <el-button @click=\"goToImport\">\n          导入漏洞\n        </el-button>\n      </div>\n    </div>\n\n    <!-- 过滤和搜索区域 -->\n    <el-card shadow=\"hover\" class=\"filter-card\">\n      <el-form :inline=\"true\" :model=\"searchParams\" class=\"search-form\">\n        <el-form-item label=\"严重程度\">\n          <el-select v-model=\"searchParams.severity\" placeholder=\"选择严重程度\" clearable>\n            <el-option label=\"严重\" value=\"critical\" />\n            <el-option label=\"高危\" value=\"high\" />\n            <el-option label=\"中危\" value=\"medium\" />\n            <el-option label=\"低危\" value=\"low\" />\n            <el-option label=\"信息\" value=\"info\" />\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"状态\">\n          <el-select v-model=\"searchParams.status\" placeholder=\"选择状态\" clearable>\n            <el-option label=\"开放\" value=\"open\" />\n            <el-option label=\"处理中\" value=\"in_progress\" />\n            <el-option label=\"已解决\" value=\"resolved\" />\n            <el-option label=\"已关闭\" value=\"closed\" />\n            <el-option label=\"误报\" value=\"false_positive\" />\n          </el-select>\n        </el-form-item>\n        \n        <el-form-item label=\"搜索\">\n          <el-input \n            v-model=\"searchParams.searchTerm\" \n            placeholder=\"搜索标题、描述或CVE编号\"\n            clearable\n          />\n        </el-form-item>\n        \n        <el-form-item>\n          <el-button type=\"primary\" @click=\"search\">搜索</el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n\n    <!-- 漏洞列表 -->\n    <el-card shadow=\"hover\" class=\"vuln-table-card\">\n      <el-table \n        v-loading=\"loading\"\n        :data=\"vulnerabilities\" \n        border \n        style=\"width: 100%\"\n        @sort-change=\"handleSortChange\"\n      >\n        <el-table-column prop=\"title\" label=\"标题\" min-width=\"200\" sortable=\"custom\">\n          <template #default=\"scope\">\n            <router-link :to=\"`/vulnerabilities/${scope.row.id}`\" class=\"vuln-link\">\n              {{ scope.row.title }}\n            </router-link>\n          </template>\n        </el-table-column>\n        \n        <el-table-column prop=\"severity\" label=\"严重程度\" width=\"120\" sortable=\"custom\">\n          <template #default=\"scope\">\n            <el-tag :type=\"$filters.severityClass(scope.row.severity)\">\n              {{ $filters.severityText(scope.row.severity) }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        \n        <el-table-column prop=\"status\" label=\"状态\" width=\"120\" sortable=\"custom\">\n          <template #default=\"scope\">\n            <el-tag :type=\"$filters.statusClass(scope.row.status)\">\n              {{ $filters.statusText(scope.row.status) }}\n            </el-tag>\n          </template>\n        </el-table-column>\n        \n        <el-table-column prop=\"cve\" label=\"CVE编号\" width=\"150\" />\n        \n        <el-table-column prop=\"cvss\" label=\"CVSS评分\" width=\"120\" sortable=\"custom\">\n          <template #default=\"scope\">\n            <span class=\"cvss-score\" :class=\"getCvssClass(scope.row.cvss)\">\n              {{ scope.row.cvss?.toFixed(1) || '-' }}\n            </span>\n          </template>\n        </el-table-column>\n        \n        <el-table-column prop=\"discoveredAt\" label=\"发现时间\" width=\"180\" sortable=\"custom\">\n          <template #default=\"scope\">\n            {{ $filters.formatDate(scope.row.discoveredAt) }}\n          </template>\n        </el-table-column>\n        \n        <el-table-column label=\"操作\" width=\"150\" fixed=\"right\">\n          <template #default=\"scope\">\n            <el-button \n              size=\"small\" \n              type=\"primary\" \n              link\n              @click=\"viewDetails(scope.row.id)\"\n            >\n              查看\n            </el-button>\n            <el-button \n              size=\"small\" \n              type=\"danger\" \n              link\n              @click=\"confirmDelete(scope.row)\"\n            >\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      \n      <!-- 分页 -->\n      <div class=\"pagination-container\">\n        <el-pagination\n          v-model:currentPage=\"searchParams.page\"\n          v-model:page-size=\"searchParams.perPage\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"pagination.total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nimport { reactive, computed, onMounted } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\nimport { ElMessageBox, ElMessage } from 'element-plus'\n\nexport default {\n  name: 'VulnerabilityList',\n  \n  setup() {\n    const store = useStore()\n    const router = useRouter()\n    const loading = computed(() => store.getters['vulnerability/isLoading'])\n    \n    // 搜索参数\n    const searchParams = reactive({\n      severity: '',\n      status: '',\n      assignedTo: '',\n      searchTerm: '',\n      sortBy: 'createdAt',\n      sortOrder: 'desc',\n      page: 1,\n      perPage: 10\n    })\n    \n    // 获取漏洞列表和分页信息\n    const vulnerabilities = computed(() => store.getters['vulnerability/allVulnerabilities'])\n    const pagination = computed(() => store.getters['vulnerability/pagination'])\n    \n    // 搜索方法\n    const search = () => {\n      store.dispatch('vulnerability/updateSearchParams', { ...searchParams })\n    }\n    \n    // 重置搜索条件\n    const resetSearch = () => {\n      Object.assign(searchParams, {\n        severity: '',\n        status: '',\n        assignedTo: '',\n        searchTerm: '',\n        sortBy: 'createdAt',\n        sortOrder: 'desc',\n        page: 1\n      })\n      search()\n    }\n    \n    // 处理表格排序变化\n    const handleSortChange = ({ prop, order }) => {\n      if (!prop) return\n      \n      // 映射前端属性名到后端字段名\n      const fieldMapping = {\n        'title': 'title',\n        'severity': 'severity',\n        'status': 'status',\n        'cvss': 'cvss',\n        'discoveredAt': 'discoveredAt',\n        'createdAt': 'createdAt'\n      }\n      \n      // 转换排序字段和顺序\n      const sortBy = fieldMapping[prop] || 'createdAt'\n      const sortOrder = order === 'ascending' ? 'asc' : 'desc'\n      \n      // 更新搜索参数并重新获取数据\n      store.dispatch('vulnerability/updateSearchParams', {\n        sortBy,\n        sortOrder\n      })\n    }\n    \n    // 处理分页大小变化\n    const handleSizeChange = (newSize) => {\n      store.dispatch('vulnerability/updateSearchParams', {\n        perPage: newSize\n      })\n    }\n    \n    // 处理页码变化\n    const handleCurrentChange = (newPage) => {\n      store.dispatch('vulnerability/updateSearchParams', {\n        page: newPage\n      })\n    }\n    \n    // 查看漏洞详情\n    const viewDetails = (id) => {\n      router.push(`/vulnerabilities/${id}`)\n    }\n    \n    // 跳转到创建页面\n    const goToCreate = () => {\n      router.push('/vulnerabilities/create')\n    }\n    \n    // 跳转到导入页面\n    const goToImport = () => {\n      router.push('/vulnerabilities/import')\n    }\n    \n    // 确认删除对话框\n    const confirmDelete = (row) => {\n      ElMessageBox.confirm(\n        `确定要删除漏洞 \"${row.title}\" 吗？`,\n        '警告',\n        {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }\n      ).then(() => {\n        // 执行删除操作\n        deleteVulnerability(row.id)\n      }).catch(() => {\n        // 取消删除\n        ElMessage({\n          type: 'info',\n          message: '已取消删除'\n        })\n      })\n    }\n    \n    // 删除漏洞\n    const deleteVulnerability = async (id) => {\n      try {\n        await store.dispatch('vulnerability/deleteVulnerability', id)\n        ElMessage({\n          type: 'success',\n          message: '删除成功'\n        })\n      } catch (error) {\n        ElMessage({\n          type: 'error',\n          message: '删除失败: ' + (error.message || '未知错误')\n        })\n      }\n    }\n    \n    // 根据CVSS评分获取颜色类\n    const getCvssClass = (score) => {\n      if (!score) return ''\n      if (score >= 9.0) return 'critical'\n      if (score >= 7.0) return 'high'\n      if (score >= 4.0) return 'medium'\n      if (score >= 0.1) return 'low'\n      return ''\n    }\n    \n    // 组件挂载时获取数据\n    onMounted(() => {\n      store.dispatch('vulnerability/fetchVulnerabilities')\n    })\n    \n    return {\n      loading,\n      searchParams,\n      vulnerabilities,\n      pagination,\n      search,\n      resetSearch,\n      handleSortChange,\n      handleSizeChange,\n      handleCurrentChange,\n      viewDetails,\n      goToCreate,\n      goToImport,\n      confirmDelete,\n      getCvssClass\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.vulnerability-list {\n  margin-bottom: 40px;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24px;\n  flex-wrap: wrap;\n  gap: 16px;\n}\n\n.header-actions {\n  display: flex;\n  gap: 12px;\n}\n\n.filter-card {\n  margin-bottom: 24px;\n}\n\n.search-form {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.vuln-table-card {\n  margin-bottom: 24px;\n}\n\n.pagination-container {\n  margin-top: 20px;\n  display: flex;\n  justify-content: flex-end;\n}\n\n.vuln-link {\n  color: #409EFF;\n  text-decoration: none;\n  font-weight: 500;\n  \n  &:hover {\n    text-decoration: underline;\n  }\n}\n\n.cvss-score {\n  font-weight: 600;\n  \n  &.critical {\n    color: #F56C6C;\n  }\n  \n  &.high {\n    color: #E6A23C;\n  }\n  \n  &.medium {\n    color: #F2D864;\n  }\n  \n  &.low {\n    color: #67C23A;\n  }\n}\n\n@media (max-width: 768px) {\n  .page-header {\n    flex-direction: column;\n    align-items: flex-start;\n  }\n  \n  .search-form {\n    flex-direction: column;\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}