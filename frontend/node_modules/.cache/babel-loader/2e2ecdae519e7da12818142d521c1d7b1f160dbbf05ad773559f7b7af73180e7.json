{"ast":null,"code":"import _slicedToArray from \"/Users/yue/Desktop/vuln-Management/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _toConsumableArray from \"/Users/yue/Desktop/vuln-Management/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.entries.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.pad-start.js\";\nexport default {\n  name: 'AnomalyDetectionDetail',\n  props: {\n    analysisData: {\n      type: Object,\n      required: true\n    }\n  },\n  data: function data() {\n    return {\n      pieSettings: {\n        radius: '65%',\n        offsetY: '20px',\n        label: {\n          formatter: '{b}: {c} ({d}%)'\n        }\n      }\n    };\n  },\n  computed: {\n    anomaliesCount: function anomaliesCount() {\n      return this.analysisData.anomaliesDetected.length;\n    },\n    highSeverityCount: function highSeverityCount() {\n      return this.analysisData.anomaliesDetected.filter(function (anomaly) {\n        return anomaly.severity === '高';\n      }).length;\n    },\n    sortedAnomalies: function sortedAnomalies() {\n      // 创建数组的副本并排序，而不是直接修改props\n      return _toConsumableArray(this.analysisData.anomaliesDetected).sort(function (a, b) {\n        return b.score - a.score;\n      });\n    },\n    severityDistributionData: function severityDistributionData() {\n      // 按严重度聚合数据\n      var distribution = this.analysisData.anomaliesDetected.reduce(function (acc, anomaly) {\n        var severity = anomaly.severity;\n        if (!acc[severity]) acc[severity] = 0;\n        acc[severity]++;\n        return acc;\n      }, {});\n\n      // 转换为图表需要的格式\n      var rows = Object.entries(distribution).map(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n          severity = _ref2[0],\n          count = _ref2[1];\n        return {\n          severity: severity,\n          count: count\n        };\n      });\n      return {\n        columns: ['severity', 'count'],\n        rows: rows\n      };\n    },\n    areaDistributionData: function areaDistributionData() {\n      // 按影响区域聚合数据\n      var distribution = this.analysisData.anomaliesDetected.reduce(function (acc, anomaly) {\n        var area = anomaly.affectedArea;\n        if (!acc[area]) acc[area] = 0;\n        acc[area]++;\n        return acc;\n      }, {});\n\n      // 转换为图表需要的格式\n      var rows = Object.entries(distribution).map(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n          area = _ref4[0],\n          count = _ref4[1];\n        return {\n          area: area,\n          count: count\n        };\n      });\n      return {\n        columns: ['area', 'count'],\n        rows: rows\n      };\n    }\n  },\n  methods: {\n    formatDate: function formatDate(date) {\n      var d = new Date(date);\n      return \"\".concat(d.getFullYear(), \"-\").concat(d.getMonth() + 1, \"-\").concat(d.getDate(), \" \").concat(d.getHours(), \":\").concat(d.getMinutes().toString().padStart(2, '0'));\n    },\n    getAnomalyTypeTag: function getAnomalyTypeTag(type) {\n      var typeMap = {\n        '突增': 'danger',\n        '突降': 'warning',\n        '异常模式': 'primary',\n        '偏差': 'info'\n      };\n      return typeMap[type] || 'info';\n    },\n    getSeverityType: function getSeverityType(severity) {\n      var types = {\n        '高': 'danger',\n        '中': 'warning',\n        '低': 'info'\n      };\n      return types[severity] || 'info';\n    },\n    getScoreColor: function getScoreColor(score) {\n      if (score >= 0.8) return '#F56C6C';\n      if (score >= 0.6) return '#E6A23C';\n      return '#909399';\n    },\n    percentFormat: function percentFormat(percentage) {\n      return percentage.toFixed(0) + '%';\n    },\n    formatRange: function formatRange(range) {\n      if (!range || !Array.isArray(range) || range.length !== 2) return '未知';\n      return \"\".concat(range[0], \" - \").concat(range[1]);\n    }\n  }\n};","map":{"version":3,"names":["name","props","analysisData","type","Object","required","data","pieSettings","radius","offsetY","label","formatter","computed","anomaliesCount","anomaliesDetected","length","highSeverityCount","filter","anomaly","severity","sortedAnomalies","_toConsumableArray","sort","a","b","score","severityDistributionData","distribution","reduce","acc","rows","entries","map","_ref","_ref2","_slicedToArray","count","columns","areaDistributionData","area","affectedArea","_ref3","_ref4","methods","formatDate","date","d","Date","concat","getFullYear","getMonth","getDate","getHours","getMinutes","toString","padStart","getAnomalyTypeTag","typeMap","getSeverityType","types","getScoreColor","percentFormat","percentage","toFixed","formatRange","range","Array","isArray"],"sources":["/Users/yue/Desktop/vuln-Management/frontend/src/components/ai/details/AnomalyDetectionDetail.vue"],"sourcesContent":["<template>\n  <div class=\"anomaly-detection-detail\">\n    <!-- 异常总览卡片 -->\n    <el-card class=\"detail-card\">\n      <template v-slot:header>\n        <div class=\"card-header\">\n          <span><i class=\"el-icon-warning-outline\"></i> 异常检测总览 ({{ analysisData.timeRange }})</span>\n        </div>\n      </template>\n      <div class=\"anomaly-overview\">\n        <div class=\"overview-metrics\">\n          <div class=\"metric-item\">\n            <div class=\"metric-icon\">\n              <i class=\"el-icon-warning\"></i>\n            </div>\n            <div class=\"metric-info\">\n              <div class=\"metric-value\">{{ anomaliesCount }}</div>\n              <div class=\"metric-label\">检测到的异常</div>\n            </div>\n          </div>\n          <div class=\"metric-item\">\n            <div class=\"metric-icon\">\n              <i class=\"el-icon-bell\"></i>\n            </div>\n            <div class=\"metric-info\">\n              <div class=\"metric-value\">{{ highSeverityCount }}</div>\n              <div class=\"metric-label\">高严重度异常</div>\n            </div>\n          </div>\n          <div class=\"metric-item\">\n            <div class=\"metric-icon\">\n              <i class=\"el-icon-data-line\"></i>\n            </div>\n            <div class=\"metric-info\">\n              <div class=\"metric-value\">{{ analysisData.baselineData.dailyAverage }}</div>\n              <div class=\"metric-label\">日均漏洞数</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"overview-description\">\n          <p>在{{ analysisData.timeRange }}内，异常检测系统共发现 {{ anomaliesCount }} 个异常模式，其中 {{ highSeverityCount }} 个为高严重度异常。系统的标准漏洞数量在 {{ formatRange(analysisData.baselineData.normalRange) }} 之间，日均为 {{ analysisData.baselineData.dailyAverage }} 个漏洞。</p>\n          <p>本次分析使用的基线数据显示，整体趋势为 <strong>{{ analysisData.baselineData.weeklyTrend }}</strong>。</p>\n        </div>\n      </div>\n    </el-card>\n    \n    <!-- 详细异常卡片 -->\n    <el-card class=\"detail-card\">\n      <template v-slot:header>\n        <div class=\"card-header\">\n          <span><i class=\"el-icon-view\"></i> 详细异常分析</span>\n        </div>\n      </template>\n      <div class=\"anomaly-details\">\n        <el-table :data=\"sortedAnomalies\" style=\"width: 100%\">\n          <el-table-column label=\"异常类型\" width=\"120\">\n            <template v-slot=\"scope\">\n              <el-tag :type=\"getAnomalyTypeTag(scope.row.type)\">{{ scope.row.type }}</el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column label=\"严重度\" width=\"100\">\n            <template v-slot=\"scope\">\n              <el-tag :type=\"getSeverityType(scope.row.severity)\" size=\"medium\">{{ scope.row.severity }}</el-tag>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"affectedArea\" label=\"影响区域\" width=\"150\"></el-table-column>\n          <el-table-column prop=\"description\" label=\"描述\" min-width=\"250\"></el-table-column>\n          <el-table-column label=\"检测时间\" width=\"180\">\n            <template v-slot=\"scope\">\n              {{ formatDate(scope.row.detectedAt) }}\n            </template>\n          </el-table-column>\n          <el-table-column label=\"异常分数\" width=\"150\">\n            <template v-slot=\"scope\">\n              <el-progress :percentage=\"scope.row.score * 100\" :format=\"percentFormat\" :color=\"getScoreColor(scope.row.score)\"></el-progress>\n            </template>\n          </el-table-column>\n        </el-table>\n      </div>\n    </el-card>\n    \n    <!-- 异常分布卡片 -->\n    <el-card class=\"detail-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <span><i class=\"el-icon-s-marketing\"></i> 异常分布分析</span>\n        </div>\n      </template>\n      <div class=\"anomaly-distribution\">\n        <div class=\"distribution-charts\">\n          <div class=\"chart-item\">\n            <h3 class=\"chart-title\">按严重度分布</h3>\n            <ve-pie\n              :data=\"severityDistributionData\"\n              :settings=\"pieSettings\"\n              height=\"300px\">\n            </ve-pie>\n          </div>\n          <div class=\"chart-item\">\n            <h3 class=\"chart-title\">按影响区域分布</h3>\n            <ve-pie\n              :data=\"areaDistributionData\"\n              :settings=\"pieSettings\"\n              height=\"300px\">\n            </ve-pie>\n          </div>\n        </div>\n      </div>\n    </el-card>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'AnomalyDetectionDetail',\n  props: {\n    analysisData: {\n      type: Object,\n      required: true\n    }\n  },\n  data() {\n    return {\n      pieSettings: {\n        radius: '65%',\n        offsetY: '20px',\n        label: {\n          formatter: '{b}: {c} ({d}%)'\n        }\n      }\n    }\n  },\n  computed: {\n    anomaliesCount() {\n      return this.analysisData.anomaliesDetected.length\n    },\n    highSeverityCount() {\n      return this.analysisData.anomaliesDetected.filter(anomaly => \n        anomaly.severity === '高'\n      ).length\n    },\n    sortedAnomalies() {\n      // 创建数组的副本并排序，而不是直接修改props\n      return [...this.analysisData.anomaliesDetected].sort((a, b) => b.score - a.score)\n    },\n    severityDistributionData() {\n      // 按严重度聚合数据\n      const distribution = this.analysisData.anomaliesDetected.reduce((acc, anomaly) => {\n        const severity = anomaly.severity\n        if (!acc[severity]) acc[severity] = 0\n        acc[severity]++\n        return acc\n      }, {})\n      \n      // 转换为图表需要的格式\n      const rows = Object.entries(distribution).map(([severity, count]) => ({\n        severity,\n        count\n      }))\n      \n      return {\n        columns: ['severity', 'count'],\n        rows\n      }\n    },\n    areaDistributionData() {\n      // 按影响区域聚合数据\n      const distribution = this.analysisData.anomaliesDetected.reduce((acc, anomaly) => {\n        const area = anomaly.affectedArea\n        if (!acc[area]) acc[area] = 0\n        acc[area]++\n        return acc\n      }, {})\n      \n      // 转换为图表需要的格式\n      const rows = Object.entries(distribution).map(([area, count]) => ({\n        area,\n        count\n      }))\n      \n      return {\n        columns: ['area', 'count'],\n        rows\n      }\n    }\n  },\n  methods: {\n    formatDate(date) {\n      const d = new Date(date)\n      return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()} ${d.getHours()}:${d.getMinutes().toString().padStart(2, '0')}`\n    },\n    getAnomalyTypeTag(type) {\n      const typeMap = {\n        '突增': 'danger',\n        '突降': 'warning',\n        '异常模式': 'primary',\n        '偏差': 'info'\n      }\n      return typeMap[type] || 'info'\n    },\n    getSeverityType(severity) {\n      const types = {\n        '高': 'danger',\n        '中': 'warning',\n        '低': 'info'\n      }\n      return types[severity] || 'info'\n    },\n    getScoreColor(score) {\n      if (score >= 0.8) return '#F56C6C'\n      if (score >= 0.6) return '#E6A23C'\n      return '#909399'\n    },\n    percentFormat(percentage) {\n      return percentage.toFixed(0) + '%'\n    },\n    formatRange(range) {\n      if (!range || !Array.isArray(range) || range.length !== 2) return '未知'\n      return `${range[0]} - ${range[1]}`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.anomaly-detection-detail {\n  .detail-card {\n    margin-bottom: 24px;\n    \n    .card-header {\n      display: flex;\n      align-items: center;\n      \n      i {\n        margin-right: 10px;\n        font-size: 18px;\n      }\n    }\n    \n    .anomaly-overview {\n      .overview-metrics {\n        display: flex;\n        margin-bottom: 20px;\n        \n        @media (max-width: 768px) {\n          flex-direction: column;\n        }\n        \n        .metric-item {\n          flex: 1;\n          display: flex;\n          align-items: center;\n          padding: 15px;\n          border-radius: 8px;\n          background-color: #F5F7FA;\n          margin-right: 15px;\n          \n          @media (max-width: 768px) {\n            margin-right: 0;\n            margin-bottom: 15px;\n          }\n          \n          &:last-child {\n            margin-right: 0;\n          }\n          \n          .metric-icon {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            background-color: #EDF2FC;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin-right: 15px;\n            \n            i {\n              font-size: 24px;\n              color: #409EFF;\n            }\n            \n            &:nth-child(2) i {\n              color: #E6A23C;\n            }\n            \n            &:nth-child(3) i {\n              color: #67C23A;\n            }\n          }\n          \n          .metric-info {\n            .metric-value {\n              font-size: 24px;\n              font-weight: 600;\n              color: #303133;\n              margin-bottom: 5px;\n            }\n            \n            .metric-label {\n              font-size: 14px;\n              color: #606266;\n            }\n          }\n        }\n      }\n      \n      .overview-description {\n        p {\n          font-size: 14px;\n          line-height: 1.6;\n          color: #606266;\n          margin-bottom: 10px;\n          \n          &:last-child {\n            margin-bottom: 0;\n          }\n        }\n      }\n    }\n    \n    .anomaly-distribution {\n      .distribution-charts {\n        display: flex;\n        \n        @media (max-width: 992px) {\n          flex-direction: column;\n        }\n        \n        .chart-item {\n          flex: 1;\n          \n          .chart-title {\n            text-align: center;\n            font-size: 16px;\n            font-weight: 500;\n            margin-bottom: 10px;\n            color: #303133;\n          }\n        }\n      }\n    }\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}