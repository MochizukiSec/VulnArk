"use strict";(self["webpackChunkvuln_management_frontend"]=self["webpackChunkvuln_management_frontend"]||[]).push([[471],{11392:(e,t,r)=>{var n=r(46518),a=r(27476),o=r(77347).f,l=r(18014),i=r(655),c=r(60511),s=r(67750),u=r(41436),p=r(96395),d=a("".slice),f=Math.min,k=u("startsWith"),m=!p&&!k&&!!function(){var e=o(String.prototype,"startsWith");return e&&!e.writable}();n({target:"String",proto:!0,forced:!m&&!k},{startsWith:function(e){var t=i(s(this));c(e);var r=l(f(arguments.length>1?arguments[1]:void 0,t.length)),n=i(e);return d(t,r,r+n.length)===n}})},28471:(e,t,r)=>{r.r(t),r.d(t,{default:()=>D});r(62010),r(27495),r(5746);var n=r(20641),a=r(53751),o=r(90033),l={class:"reports-page"},i={class:"report-card-container"},c={class:"report-options"},s={class:"severity-checkboxes"},u={class:"reports-list-container"},p={class:"card-header"},d={class:"filter-toolbar"},f={class:"reports-list"},k={key:1,class:"reports-grid"},m={class:"report-header"},g={class:"report-format"},h={class:"report-name"},v={class:"report-date"},b={class:"report-actions"},y={key:0,class:"report-status pending"},F={key:1,class:"report-status failed"},L={class:"pagination-container"};function _(e,t,r,_,x,w){var C=(0,n.g2)("el-option"),R=(0,n.g2)("el-option-group"),S=(0,n.g2)("el-select"),V=(0,n.g2)("el-form-item"),W=(0,n.g2)("el-col"),T=(0,n.g2)("el-row"),A=(0,n.g2)("el-date-picker"),D=(0,n.g2)("el-checkbox"),z=(0,n.g2)("el-checkbox-group"),E=(0,n.g2)("el-button"),I=(0,n.g2)("el-form"),U=(0,n.g2)("el-card"),X=(0,n.g2)("el-input"),K=(0,n.g2)("el-empty"),P=(0,n.g2)("el-tag"),O=(0,n.g2)("el-pagination"),j=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",l,[t[32]||(t[32]=(0,n.Fv)('<div class="page-header" data-v-5be1af50><div class="header-content" data-v-5be1af50><h1 class="page-title" data-v-5be1af50><span class="title-icon" data-v-5be1af50><i class="el-icon-document" data-v-5be1af50></i></span> 安全报告 <span class="title-highlight" data-v-5be1af50>管理</span></h1><p class="page-subtitle" data-v-5be1af50>查看、生成和导出系统安全漏洞相关报告</p></div></div>',1)),(0,n.Lk)("div",i,[(0,n.bF)(U,{shadow:"hover",class:"report-card"},{header:(0,n.k6)((function(){return t[7]||(t[7]=[(0,n.Lk)("div",{class:"card-header"},[(0,n.Lk)("h2",{class:"section-title"},[(0,n.Lk)("i",{class:"el-icon-document-add"}),(0,n.eW)(" 报告生成 ")])],-1)])})),default:(0,n.k6)((function(){return[(0,n.Lk)("div",c,[(0,n.bF)(I,{model:_.reportForm,"label-position":"top"},{default:(0,n.k6)((function(){return[(0,n.bF)(T,{gutter:24},{default:(0,n.k6)((function(){return[(0,n.bF)(W,{xs:24,sm:12},{default:(0,n.k6)((function(){return[(0,n.bF)(V,{label:"报告类型"},{default:(0,n.k6)((function(){return[(0,n.bF)(S,{modelValue:_.reportForm.type,"onUpdate:modelValue":t[0]||(t[0]=function(e){return _.reportForm.type=e}),placeholder:"选择报告类型",style:{width:"100%"}},{default:(0,n.k6)((function(){return[(0,n.bF)(R,{label:"常规报告"},{default:(0,n.k6)((function(){return[(0,n.bF)(C,{label:"漏洞摘要报告",value:"summary"},{default:(0,n.k6)((function(){return t[8]||(t[8]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document option-icon summary"}),(0,n.Lk)("span",null,"漏洞摘要报告")],-1)])})),_:1}),(0,n.bF)(C,{label:"详细漏洞报告",value:"detailed"},{default:(0,n.k6)((function(){return t[9]||(t[9]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document-checked option-icon detailed"}),(0,n.Lk)("span",null,"详细漏洞报告")],-1)])})),_:1})]})),_:1}),(0,n.bF)(R,{label:"专项报告"},{default:(0,n.k6)((function(){return[(0,n.bF)(C,{label:"合规性报告",value:"compliance"},{default:(0,n.k6)((function(){return t[10]||(t[10]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-collection-check option-icon compliance"}),(0,n.Lk)("span",null,"合规性报告")],-1)])})),_:1}),(0,n.bF)(C,{label:"趋势分析报告",value:"trend"},{default:(0,n.k6)((function(){return t[11]||(t[11]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-data-line option-icon trend"}),(0,n.Lk)("span",null,"趋势分析报告")],-1)])})),_:1})]})),_:1})]})),_:1},8,["modelValue"])]})),_:1})]})),_:1}),(0,n.bF)(W,{xs:24,sm:12},{default:(0,n.k6)((function(){return[(0,n.bF)(V,{label:"报告格式"},{default:(0,n.k6)((function(){return[(0,n.bF)(S,{modelValue:_.reportForm.format,"onUpdate:modelValue":t[1]||(t[1]=function(e){return _.reportForm.format=e}),placeholder:"选择输出格式",style:{width:"100%"}},{default:(0,n.k6)((function(){return[(0,n.bF)(C,{label:"PDF文档",value:"pdf"},{default:(0,n.k6)((function(){return t[12]||(t[12]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document option-icon pdf"}),(0,n.Lk)("span",null,"PDF文档")],-1)])})),_:1}),(0,n.bF)(C,{label:"Excel工作表",value:"excel"},{default:(0,n.k6)((function(){return t[13]||(t[13]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document option-icon excel"}),(0,n.Lk)("span",null,"Excel工作表")],-1)])})),_:1}),(0,n.bF)(C,{label:"Word文档",value:"word"},{default:(0,n.k6)((function(){return t[14]||(t[14]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document option-icon word"}),(0,n.Lk)("span",null,"Word文档")],-1)])})),_:1}),(0,n.bF)(C,{label:"HTML网页",value:"html"},{default:(0,n.k6)((function(){return t[15]||(t[15]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document option-icon html"}),(0,n.Lk)("span",null,"HTML网页")],-1)])})),_:1}),(0,n.bF)(C,{label:"文本文件",value:"text"},{default:(0,n.k6)((function(){return t[16]||(t[16]=[(0,n.Lk)("div",{class:"report-option"},[(0,n.Lk)("i",{class:"el-icon-document option-icon text"}),(0,n.Lk)("span",null,"文本文件")],-1)])})),_:1})]})),_:1},8,["modelValue"])]})),_:1})]})),_:1})]})),_:1}),(0,n.bF)(V,{label:"报告时间范围"},{default:(0,n.k6)((function(){return[(0,n.bF)(A,{modelValue:_.reportForm.dateRange,"onUpdate:modelValue":t[2]||(t[2]=function(e){return _.reportForm.dateRange=e}),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"100%"},class:"date-range-picker"},null,8,["modelValue"])]})),_:1}),(0,n.bF)(V,{label:"包含的严重程度"},{default:(0,n.k6)((function(){return[(0,n.Lk)("div",s,[(0,n.bF)(z,{modelValue:_.reportForm.severities,"onUpdate:modelValue":t[3]||(t[3]=function(e){return _.reportForm.severities=e})},{default:(0,n.k6)((function(){return[(0,n.bF)(D,{label:"critical"},{default:(0,n.k6)((function(){return t[17]||(t[17]=[(0,n.Lk)("span",{class:"severity-checkbox"},[(0,n.Lk)("span",{class:"severity-dot critical"}),(0,n.Lk)("span",null,"严重")],-1)])})),_:1}),(0,n.bF)(D,{label:"high"},{default:(0,n.k6)((function(){return t[18]||(t[18]=[(0,n.Lk)("span",{class:"severity-checkbox"},[(0,n.Lk)("span",{class:"severity-dot high"}),(0,n.Lk)("span",null,"高危")],-1)])})),_:1}),(0,n.bF)(D,{label:"medium"},{default:(0,n.k6)((function(){return t[19]||(t[19]=[(0,n.Lk)("span",{class:"severity-checkbox"},[(0,n.Lk)("span",{class:"severity-dot medium"}),(0,n.Lk)("span",null,"中危")],-1)])})),_:1}),(0,n.bF)(D,{label:"low"},{default:(0,n.k6)((function(){return t[20]||(t[20]=[(0,n.Lk)("span",{class:"severity-checkbox"},[(0,n.Lk)("span",{class:"severity-dot low"}),(0,n.Lk)("span",null,"低危")],-1)])})),_:1}),(0,n.bF)(D,{label:"info"},{default:(0,n.k6)((function(){return t[21]||(t[21]=[(0,n.Lk)("span",{class:"severity-checkbox"},[(0,n.Lk)("span",{class:"severity-dot info"}),(0,n.Lk)("span",null,"信息")],-1)])})),_:1})]})),_:1},8,["modelValue"])])]})),_:1}),(0,n.bF)(V,null,{default:(0,n.k6)((function(){return[(0,n.bF)(E,{type:"primary",onClick:_.generateReport,loading:_.generating,class:"generate-btn"},{default:(0,n.k6)((function(){return t[22]||(t[22]=[(0,n.Lk)("i",{class:"el-icon-document-add"},null,-1),(0,n.eW)(" 生成报告 ")])})),_:1},8,["onClick","loading"])]})),_:1})]})),_:1},8,["model"])])]})),_:1})]),(0,n.Lk)("div",u,[(0,n.bF)(U,{shadow:"hover",class:"reports-list-card"},{header:(0,n.k6)((function(){return[(0,n.Lk)("div",p,[t[25]||(t[25]=(0,n.Lk)("h2",{class:"section-title"},[(0,n.Lk)("i",{class:"el-icon-document-copy"}),(0,n.eW)(" 报告历史 ")],-1)),(0,n.Lk)("div",d,[(0,n.bF)(X,{modelValue:_.filterForm.search,"onUpdate:modelValue":t[4]||(t[4]=function(e){return _.filterForm.search=e}),placeholder:"搜索报告名称",clearable:"","prefix-icon":"el-icon-search",class:"search-input",onKeyup:(0,a.jR)(_.searchReports,["enter"])},null,8,["modelValue","onKeyup"]),(0,n.bF)(S,{modelValue:_.filterForm.type,"onUpdate:modelValue":t[5]||(t[5]=function(e){return _.filterForm.type=e}),placeholder:"报告类型",clearable:"",onChange:_.searchReports},{default:(0,n.k6)((function(){return[(0,n.bF)(C,{label:"摘要报告",value:"summary"}),(0,n.bF)(C,{label:"详细报告",value:"detailed"}),(0,n.bF)(C,{label:"合规报告",value:"compliance"}),(0,n.bF)(C,{label:"趋势分析",value:"trend"})]})),_:1},8,["modelValue","onChange"]),(0,n.bF)(S,{modelValue:_.filterForm.format,"onUpdate:modelValue":t[6]||(t[6]=function(e){return _.filterForm.format=e}),placeholder:"文件格式",clearable:"",onChange:_.searchReports},{default:(0,n.k6)((function(){return[(0,n.bF)(C,{label:"PDF",value:"pdf"}),(0,n.bF)(C,{label:"Excel",value:"excel"}),(0,n.bF)(C,{label:"Word",value:"word"}),(0,n.bF)(C,{label:"HTML",value:"html"})]})),_:1},8,["modelValue","onChange"]),(0,n.bF)(E,{type:"primary",onClick:_.searchReports},{default:(0,n.k6)((function(){return t[23]||(t[23]=[(0,n.Lk)("i",{class:"el-icon-search"},null,-1),(0,n.eW)(" 搜索 ")])})),_:1},8,["onClick"]),(0,n.bF)(E,{onClick:_.resetFilter},{default:(0,n.k6)((function(){return t[24]||(t[24]=[(0,n.Lk)("i",{class:"el-icon-refresh"},null,-1),(0,n.eW)(" 重置 ")])})),_:1},8,["onClick"])])])]})),default:(0,n.k6)((function(){return[(0,n.bo)(((0,n.uX)(),(0,n.CE)("div",f,[_.loading||0!==_.reports.length?((0,n.uX)(),(0,n.CE)("div",k,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(_.reports,(function(e){return(0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"report-card-item"},[(0,n.Lk)("div",m,[(0,n.bF)(P,{type:_.getReportTagType(e.type),effect:"light",class:"report-type"},{default:(0,n.k6)((function(){return[(0,n.eW)((0,o.v_)(_.getReportTypeText(e.type)),1)]})),_:2},1032,["type"]),(0,n.Lk)("div",g,(0,o.v_)(e.format?e.format.toUpperCase():""),1)]),(0,n.Lk)("h3",h,(0,o.v_)(e.name),1),(0,n.Lk)("div",v,[t[27]||(t[27]=(0,n.Lk)("i",{class:"el-icon-date"},null,-1)),(0,n.Lk)("span",null,(0,o.v_)(_.formatDate(e.created_at)),1)]),(0,n.Lk)("div",b,[(0,n.bF)(E,{type:"primary",size:"small",disabled:!e.file_url,onClick:function(t){return _.downloadReport(e)}},{default:(0,n.k6)((function(){return t[28]||(t[28]=[(0,n.Lk)("i",{class:"el-icon-download"},null,-1),(0,n.eW)(" 下载 ")])})),_:2},1032,["disabled","onClick"]),(0,n.bF)(E,{type:"danger",size:"small",onClick:function(t){return _.confirmDelete(e)}},{default:(0,n.k6)((function(){return t[29]||(t[29]=[(0,n.Lk)("i",{class:"el-icon-delete"},null,-1),(0,n.eW)(" 删除 ")])})),_:2},1032,["onClick"])]),"pending"===e.status?((0,n.uX)(),(0,n.CE)("div",y,t[30]||(t[30]=[(0,n.Lk)("i",{class:"el-icon-loading"},null,-1),(0,n.eW)(" 生成中... ")]))):"failed"===e.status?((0,n.uX)(),(0,n.CE)("div",F,t[31]||(t[31]=[(0,n.Lk)("i",{class:"el-icon-warning-outline"},null,-1),(0,n.eW)(" 生成失败 ")]))):(0,n.Q3)("",!0)])})),128))])):((0,n.uX)(),(0,n.Wv)(K,{key:0,description:"暂无报告记录",class:"empty-state"},{default:(0,n.k6)((function(){return[(0,n.bF)(E,{type:"primary",onClick:_.scrollToGenerator},{default:(0,n.k6)((function(){return t[26]||(t[26]=[(0,n.eW)(" 创建第一份报告 ")])})),_:1},8,["onClick"])]})),_:1})),(0,n.Lk)("div",L,[(0,n.bF)(O,{"current-page":_.pagination.page,"page-size":_.pagination.pageSize,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:_.pagination.total,onSizeChange:_.handleSizeChange,onCurrentChange:_.handlePageChange,background:""},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])),[[j,_.loading]])]})),_:1})])])}var x=r(14048),w=r(30388),C=(r(52675),r(89463),r(28706),r(1688),r(23288),r(11392),r(50953)),R=r(20163),S=r(77918),V=r(66278);const W={name:"Reports",setup:function(){var e=(0,V.Pj)(),t=(0,n.EW)((function(){return e.getters["report/isLoading"]})),r=(0,n.EW)((function(){return e.getters["report/isGenerating"]})),a=(0,C.Kh)({page:1,pageSize:10,total:0}),o=(0,C.Kh)({type:"",format:"",search:""}),l=(0,C.Kh)({name:"",type:"summary",format:"pdf",dateRange:[],severities:["critical","high","medium"],description:""}),i=(0,n.EW)((function(){return e.getters["report/allReports"]})),c=function(){var t=(0,w.A)((0,x.A)().mark((function t(){var r;return(0,x.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.dispatch("report/fetchReports",{page:a.page,limit:a.pageSize,type:o.type,format:o.format,search:o.search});case 3:r=e.getters["report/pagination"],a.total=r.total,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("加载报告失败:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(){return t.apply(this,arguments)}}();(0,n.sV)((function(){c()}));var s=function(){a.page=1,c()},u=function(){Object.assign(o,{type:"",format:"",search:""}),s()},p=function(e){a.page=e,c()},d=function(e){a.pageSize=e,a.page=1,c()},f=function(e){var t={summary:"摘要报告",detailed:"详细报告",compliance:"合规报告",trend:"趋势分析"};return t[e]||e},k=function(e){var t={summary:"",detailed:"success",compliance:"warning",trend:"info"};return t[e]||""},m=function(e){if(!e)return"无日期";try{var t=new Date(e);return isNaN(t.getTime())?"无效日期":t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("日期格式化错误:",r),"无效日期"}},g=function(){document.querySelector(".report-card").scrollIntoView({behavior:"smooth",block:"start"})},h=function(){var t=(0,w.A)((0,x.A)().mark((function t(){var r,n,a,o,i;return(0,x.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(l.dateRange&&2===l.dateRange.length){t.next=3;break}return R.nk.warning("请选择报告时间范围"),t.abrupt("return");case 3:if(0!==l.severities.length){t.next=6;break}return R.nk.warning("请至少选择一个严重程度级别"),t.abrupt("return");case 6:if(e.getters["auth/isAuthenticated"]){t.next=13;break}return t.next=9,e.dispatch("auth/refreshTokenState");case 9:if(r=t.sent,r){t.next=13;break}return R.nk.error("您需要登录才能生成报告"),t.abrupt("return");case 13:if(l.name||(n={summary:"漏洞摘要报告",detailed:"详细漏洞报告",compliance:"合规性报告",trend:"趋势分析报告"},l.name="".concat((new Date).getFullYear(),"年").concat(n[l.type])),t.prev=14,a=localStorage.getItem("token"),a){t.next=19;break}return R.nk.error("未找到授权令牌，请重新登录"),t.abrupt("return");case 19:return o={name:l.name,type:l.type,format:l.format,start_date:l.dateRange[0],end_date:l.dateRange[1],severities:l.severities,description:l.description},t.next=22,e.dispatch("report/createReport",o);case 22:R.nk.success({message:"报告生成请求已提交，后端功能待完善",duration:5e3}),l.name="",l.description="",c(),t.next=32;break;case 28:t.prev=28,t.t0=t["catch"](14),console.error("生成报告失败:",t.t0),t.t0.response&&401===t.t0.response.status?R.nk.error({message:"身份验证失败，请重新登录后再试",duration:5e3}):R.nk.error({message:"报告生成失败: "+((null===(i=t.t0.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.error)||"后端功能未完全实现，请等待功能完善"),duration:5e3});case 32:case"end":return t.stop()}}),t,null,[[14,28]])})));return function(){return t.apply(this,arguments)}}(),v=function(e){if(e.file_url)try{var t=e.file_url;t.startsWith("http")||t.startsWith("/api")||(t="/api"+t),window.open(t,"_blank")}catch(r){console.error("下载报告失败:",r),R.nk.error("下载报告失败，请稍后再试")}else R.nk.warning("报告文件尚未生成完成，请稍后再试")},b=function(t){S.s.confirm('确定要删除报告"'.concat(t.name,'"吗？'),"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,w.A)((0,x.A)().mark((function r(){return(0,x.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.dispatch("report/deleteReport",t.id);case 3:c(),r.next=9;break;case 6:r.prev=6,r.t0=r["catch"](0),console.error("删除报告失败:",r.t0);case 9:case"end":return r.stop()}}),r,null,[[0,6]])}))))["catch"]((function(){}))},y=function(){var t=(0,w.A)((0,x.A)().mark((function t(r,n){return(0,x.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.dispatch("report/generateSummaryReport",{startDate:null===r||void 0===r?void 0:r.toISOString(),endDate:null===n||void 0===n?void 0:n.toISOString()});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.error("生成摘要报告失败:",t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(e,r){return t.apply(this,arguments)}}(),F=function(){var t=(0,w.A)((0,x.A)().mark((function t(r,n,a,o){return(0,x.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.dispatch("report/generateDetailedReport",{startDate:null===r||void 0===r?void 0:r.toISOString(),endDate:null===n||void 0===n?void 0:n.toISOString(),severity:a,status:o});case 3:t.next=8;break;case 5:t.prev=5,t.t0=t["catch"](0),console.error("生成详细报告失败:",t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(e,r,n,a){return t.apply(this,arguments)}}();return{loading:t,generating:r,pagination:a,filterForm:o,reportForm:l,reports:i,getReportTypeText:f,getReportTagType:k,formatDate:m,scrollToGenerator:g,generateReport:h,downloadReport:v,confirmDelete:b,searchReports:s,resetFilter:u,handlePageChange:p,handleSizeChange:d,generateSummaryReport:y,generateDetailedReport:F}}};var T=r(66262);const A=(0,T.A)(W,[["render",_],["__scopeId","data-v-5be1af50"]]),D=A},41436:(e,t,r)=>{var n=r(78227),a=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[a]=!1,"/./"[e](t)}catch(n){}}return!1}},60511:(e,t,r)=>{var n=r(60788),a=TypeError;e.exports=function(e){if(n(e))throw new a("The method doesn't accept regular expressions");return e}},60788:(e,t,r)=>{var n=r(20034),a=r(22195),o=r(78227),l=o("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[l])?!!t:"RegExp"===a(e))}}}]);
//# sourceMappingURL=471.4a72bf67.js.map