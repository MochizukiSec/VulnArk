"use strict";(self["webpackChunkvuln_management_frontend"]=self["webpackChunkvuln_management_frontend"]||[]).push([[17],{11392:(e,t,a)=>{var r=a(46518),n=a(27476),l=a(77347).f,s=a(18014),i=a(655),o=a(60511),u=a(67750),c=a(41436),d=a(96395),m=n("".slice),f=Math.min,p=c("startsWith"),v=!d&&!p&&!!function(){var e=l(String.prototype,"startsWith");return e&&!e.writable}();r({target:"String",proto:!0,forced:!v&&!p},{startsWith:function(e){var t=i(u(this));o(e);var a=s(f(arguments.length>1?arguments[1]:void 0,t.length)),r=i(e);return m(t,a,a+r.length)===r}})},41436:(e,t,a)=>{var r=a(78227),n=r("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[n]=!1,"/./"[e](t)}catch(r){}}return!1}},49017:(e,t,a)=>{a.r(t),a.d(t,{default:()=>G});var r=a(20641),n=a(90033),l=a(53751),s={class:"user-profile-container"},i={class:"profile-header"},o={class:"profile-avatar"},u={class:"avatar-upload"},c={class:"profile-name"},d={class:"user-role"},m={class:"profile-info-list"},f={class:"info-item"},p={class:"item-value"},v={class:"info-item"},k={class:"item-value"},b={class:"info-item"},g={class:"item-value"},h={class:"info-item"},w={class:"item-value"},L={class:"info-item"},y={class:"item-value"},F={class:"profile-actions"},_={class:"card-header"},V={class:"card-header"},x={class:"security-items"},N={class:"security-item"},P={class:"security-item"},D={class:"card-header"},U={class:"notification-item"},A={class:"notification-item"},S={class:"notification-item"};function C(e,t,a,C,R,T){var W=(0,r.g2)("el-avatar"),E=(0,r.g2)("el-button"),K=(0,r.g2)("el-card"),z=(0,r.g2)("el-col"),q=(0,r.g2)("el-input"),I=(0,r.g2)("el-form-item"),B=(0,r.g2)("el-row"),j=(0,r.g2)("el-form"),M=(0,r.g2)("el-tab-pane"),$=(0,r.g2)("el-switch"),X=(0,r.g2)("el-tabs");return(0,r.uX)(),(0,r.CE)("div",s,[t[39]||(t[39]=(0,r.Lk)("div",{class:"page-header"},[(0,r.Lk)("h1",{class:"page-title"},"个人资料"),(0,r.Lk)("p",{class:"page-subtitle"},"查看和管理您的个人账户信息")],-1)),(0,r.bF)(B,{gutter:20},{default:(0,r.k6)((function(){return[(0,r.bF)(z,{xs:24,sm:24,md:8,lg:7,xl:6},{default:(0,r.k6)((function(){return[(0,r.bF)(K,{class:"profile-card",shadow:"hover"},{default:(0,r.k6)((function(){return[(0,r.Lk)("div",i,[(0,r.Lk)("div",o,[(0,r.bF)(W,{size:100,src:C.userAvatar,icon:"el-icon-user"},null,8,["src"]),(0,r.Lk)("div",u,[(0,r.bF)(E,{type:"primary",size:"small",round:"",plain:"",onClick:C.handleAvatarClick},{default:(0,r.k6)((function(){return t[15]||(t[15]=[(0,r.Lk)("i",{class:"el-icon-camera"},null,-1),(0,r.eW)(" 更换头像 ")])})),_:1},8,["onClick"]),(0,r.Lk)("input",{ref:"avatarInput",type:"file",accept:"image/*",style:{display:"none"},onChange:t[0]||(t[0]=function(){return C.handleAvatarUpload&&C.handleAvatarUpload.apply(C,arguments)})},null,544)])]),(0,r.Lk)("div",c,[(0,r.Lk)("h2",null,(0,n.v_)(C.userFullName),1),(0,r.Lk)("span",d,(0,n.v_)(C.userRoleText),1)])]),(0,r.Lk)("div",m,[(0,r.Lk)("div",f,[t[16]||(t[16]=(0,r.Lk)("i",{class:"el-icon-user"},null,-1)),t[17]||(t[17]=(0,r.Lk)("span",{class:"item-label"},"用户名:",-1)),(0,r.Lk)("span",p,(0,n.v_)(C.getUserField("username",[],"未设置")),1)]),(0,r.Lk)("div",v,[t[18]||(t[18]=(0,r.Lk)("i",{class:"el-icon-message"},null,-1)),t[19]||(t[19]=(0,r.Lk)("span",{class:"item-label"},"邮箱:",-1)),(0,r.Lk)("span",k,(0,n.v_)(C.getUserField("email",[],"未设置")),1)]),(0,r.Lk)("div",b,[t[20]||(t[20]=(0,r.Lk)("i",{class:"el-icon-office-building"},null,-1)),t[21]||(t[21]=(0,r.Lk)("span",{class:"item-label"},"部门:",-1)),(0,r.Lk)("span",g,(0,n.v_)(C.getUserField("department",[],"未设置")),1)]),(0,r.Lk)("div",h,[t[22]||(t[22]=(0,r.Lk)("i",{class:"el-icon-date"},null,-1)),t[23]||(t[23]=(0,r.Lk)("span",{class:"item-label"},"注册时间:",-1)),(0,r.Lk)("span",w,(0,n.v_)(C.formatDate(C.getUserField("createdAt",["created_at","createTime"]))),1)]),(0,r.Lk)("div",L,[t[24]||(t[24]=(0,r.Lk)("i",{class:"el-icon-time"},null,-1)),t[25]||(t[25]=(0,r.Lk)("span",{class:"item-label"},"上次登录:",-1)),(0,r.Lk)("span",y,(0,n.v_)(C.formatDate(C.getUserField("lastLogin",["last_login","loginTime"]))),1)])]),(0,r.Lk)("div",F,[(0,r.bF)(E,{type:"danger",round:"",plain:"",size:"small",onClick:C.logout,class:"logout-btn"},{default:(0,r.k6)((function(){return t[26]||(t[26]=[(0,r.Lk)("i",{class:"el-icon-switch-button"},null,-1),(0,r.eW)(" 退出登录 ")])})),_:1},8,["onClick"])])]})),_:1})]})),_:1}),(0,r.bF)(z,{xs:24,sm:24,md:16,lg:17,xl:18},{default:(0,r.k6)((function(){return[(0,r.bF)(X,{modelValue:C.activeTab,"onUpdate:modelValue":t[14]||(t[14]=function(e){return C.activeTab=e}),class:"profile-tabs"},{default:(0,r.k6)((function(){return[(0,r.bF)(M,{label:"个人信息",name:"basic"},{default:(0,r.k6)((function(){return[(0,r.bF)(K,{shadow:"hover"},{header:(0,r.k6)((function(){return[(0,r.Lk)("div",_,[t[28]||(t[28]=(0,r.Lk)("span",null,"个人信息",-1)),(0,r.bF)(E,{type:"primary",plain:"",size:"small",onClick:C.submitProfileForm,loading:C.loading.profile},{default:(0,r.k6)((function(){return t[27]||(t[27]=[(0,r.eW)("保存更改")])})),_:1},8,["onClick","loading"])])]})),default:(0,r.k6)((function(){return[(0,r.bF)(j,{ref:"profileForm",model:C.profileData,rules:C.profileRules,"label-position":"top",onSubmit:(0,l.D$)(C.submitProfileForm,["prevent"])},{default:(0,r.k6)((function(){return[(0,r.bF)(B,{gutter:20},{default:(0,r.k6)((function(){return[(0,r.bF)(z,{xs:24,sm:12},{default:(0,r.k6)((function(){return[(0,r.bF)(I,{label:"名字",prop:"firstName"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.profileData.firstName,"onUpdate:modelValue":t[1]||(t[1]=function(e){return C.profileData.firstName=e}),placeholder:"请输入名字"},null,8,["modelValue"])]})),_:1})]})),_:1}),(0,r.bF)(z,{xs:24,sm:12},{default:(0,r.k6)((function(){return[(0,r.bF)(I,{label:"姓氏",prop:"lastName"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.profileData.lastName,"onUpdate:modelValue":t[2]||(t[2]=function(e){return C.profileData.lastName=e}),placeholder:"请输入姓氏"},null,8,["modelValue"])]})),_:1})]})),_:1})]})),_:1}),(0,r.bF)(I,{label:"用户名",prop:"username"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.profileData.username,"onUpdate:modelValue":t[3]||(t[3]=function(e){return C.profileData.username=e}),placeholder:"请输入用户名"},null,8,["modelValue"])]})),_:1}),(0,r.bF)(I,{label:"邮箱",prop:"email"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.profileData.email,"onUpdate:modelValue":t[4]||(t[4]=function(e){return C.profileData.email=e}),type:"email",placeholder:"请输入邮箱"},null,8,["modelValue"])]})),_:1}),(0,r.bF)(I,{label:"部门",prop:"department"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.profileData.department,"onUpdate:modelValue":t[5]||(t[5]=function(e){return C.profileData.department=e}),placeholder:"请输入部门名称"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules","onSubmit"])]})),_:1})]})),_:1}),(0,r.bF)(M,{label:"安全设置",name:"security"},{default:(0,r.k6)((function(){return[(0,r.bF)(K,{shadow:"hover"},{header:(0,r.k6)((function(){return[(0,r.Lk)("div",V,[t[30]||(t[30]=(0,r.Lk)("span",null,"修改密码",-1)),(0,r.bF)(E,{type:"primary",plain:"",size:"small",onClick:C.submitPasswordForm,loading:C.loading.password},{default:(0,r.k6)((function(){return t[29]||(t[29]=[(0,r.eW)("更新密码")])})),_:1},8,["onClick","loading"])])]})),default:(0,r.k6)((function(){return[(0,r.bF)(j,{ref:"passwordForm",model:C.passwordData,rules:C.passwordRules,"label-position":"top",onSubmit:(0,l.D$)(C.submitPasswordForm,["prevent"])},{default:(0,r.k6)((function(){return[(0,r.bF)(I,{label:"当前密码",prop:"currentPassword"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.passwordData.currentPassword,"onUpdate:modelValue":t[6]||(t[6]=function(e){return C.passwordData.currentPassword=e}),type:"password","show-password":"",placeholder:"请输入当前密码"},null,8,["modelValue"])]})),_:1}),(0,r.bF)(I,{label:"新密码",prop:"newPassword"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.passwordData.newPassword,"onUpdate:modelValue":t[7]||(t[7]=function(e){return C.passwordData.newPassword=e}),type:"password","show-password":"",placeholder:"请输入新密码（至少6个字符）"},null,8,["modelValue"])]})),_:1}),(0,r.bF)(I,{label:"确认新密码",prop:"confirmPassword"},{default:(0,r.k6)((function(){return[(0,r.bF)(q,{modelValue:C.passwordData.confirmPassword,"onUpdate:modelValue":t[8]||(t[8]=function(e){return C.passwordData.confirmPassword=e}),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model","rules","onSubmit"])]})),_:1}),(0,r.bF)(K,{shadow:"hover",class:"mt-20"},{header:(0,r.k6)((function(){return t[31]||(t[31]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"账户安全")],-1)])})),default:(0,r.k6)((function(){return[(0,r.Lk)("div",x,[(0,r.Lk)("div",N,[t[32]||(t[32]=(0,r.Lk)("div",{class:"security-item-content"},[(0,r.Lk)("div",{class:"security-item-icon"},[(0,r.Lk)("i",{class:"el-icon-lock"})]),(0,r.Lk)("div",{class:"security-item-text"},[(0,r.Lk)("h3",null,"双因素认证"),(0,r.Lk)("p",null,"增强账户安全性，需要额外的验证步骤才能登录")])],-1)),(0,r.bF)($,{modelValue:C.securitySettings.twoFactor,"onUpdate:modelValue":t[9]||(t[9]=function(e){return C.securitySettings.twoFactor=e}),disabled:!0},null,8,["modelValue"])]),(0,r.Lk)("div",P,[t[33]||(t[33]=(0,r.Lk)("div",{class:"security-item-content"},[(0,r.Lk)("div",{class:"security-item-icon"},[(0,r.Lk)("i",{class:"el-icon-bell"})]),(0,r.Lk)("div",{class:"security-item-text"},[(0,r.Lk)("h3",null,"登录通知"),(0,r.Lk)("p",null,"当有新设备登录您的账户时发送通知")])],-1)),(0,r.bF)($,{modelValue:C.securitySettings.loginNotifications,"onUpdate:modelValue":t[10]||(t[10]=function(e){return C.securitySettings.loginNotifications=e}),disabled:!0},null,8,["modelValue"])])])]})),_:1})]})),_:1}),(0,r.bF)(M,{label:"通知设置",name:"notifications"},{default:(0,r.k6)((function(){return[(0,r.bF)(K,{shadow:"hover"},{header:(0,r.k6)((function(){return[(0,r.Lk)("div",D,[t[35]||(t[35]=(0,r.Lk)("span",null,"通知偏好",-1)),(0,r.bF)(E,{type:"primary",plain:"",size:"small",disabled:!0},{default:(0,r.k6)((function(){return t[34]||(t[34]=[(0,r.eW)("保存设置")])})),_:1})])]})),default:(0,r.k6)((function(){return[(0,r.Lk)("div",U,[t[36]||(t[36]=(0,r.Lk)("div",{class:"notification-text"},[(0,r.Lk)("h3",null,"漏洞更新通知"),(0,r.Lk)("p",null,"当有新漏洞添加或现有漏洞状态变更时通知我")],-1)),(0,r.bF)($,{modelValue:C.notificationSettings.vulnerabilities,"onUpdate:modelValue":t[11]||(t[11]=function(e){return C.notificationSettings.vulnerabilities=e}),disabled:!0},null,8,["modelValue"])]),(0,r.Lk)("div",A,[t[37]||(t[37]=(0,r.Lk)("div",{class:"notification-text"},[(0,r.Lk)("h3",null,"周报告摘要"),(0,r.Lk)("p",null,"每周发送漏洞管理工作摘要")],-1)),(0,r.bF)($,{modelValue:C.notificationSettings.weeklyReport,"onUpdate:modelValue":t[12]||(t[12]=function(e){return C.notificationSettings.weeklyReport=e}),disabled:!0},null,8,["modelValue"])]),(0,r.Lk)("div",S,[t[38]||(t[38]=(0,r.Lk)("div",{class:"notification-text"},[(0,r.Lk)("h3",null,"系统公告"),(0,r.Lk)("p",null,"接收关于系统更新和维护的消息")],-1)),(0,r.bF)($,{modelValue:C.notificationSettings.systemAnnouncements,"onUpdate:modelValue":t[13]||(t[13]=function(e){return C.notificationSettings.systemAnnouncements=e}),disabled:!0},null,8,["modelValue"])])]})),_:1})]})),_:1})]})),_:1},8,["modelValue"])]})),_:1})]})),_:1})])}var R=a(14048),T=a(30388),W=(a(52675),a(89463),a(2259),a(16280),a(76918),a(64346),a(26099),a(47764),a(62953),a(12635));function E(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=(0,W.A)(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,s=!0,i=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:function(e){i=!0,l=e},f:function(){try{s||null==a["return"]||a["return"]()}finally{if(i)throw l}}}}a(28706),a(44114),a(23288),a(11392),a(42762);var K=a(50953),z=a(66278),q=a(75220),I=a(20163),B=a(77918),j=a(94335);const M={name:"UserProfile",setup:function(){var e=(0,z.Pj)(),t=(0,q.rd)(),a=(0,K.KR)(null),n=(0,K.KR)(null),l=(0,K.KR)(null),s=(0,K.KR)("basic"),i=(0,r.EW)((function(){var t=e.getters["auth/currentUser"]||{};return console.log("当前用户信息:",t),t})),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!i.value)return a;if(void 0!==i.value[e])return i.value[e];var r,n=E(t);try{for(n.s();!(r=n.n()).done;){var l=r.value;if(void 0!==i.value[l])return i.value[l]}}catch(s){n.e(s)}finally{n.f()}return a},u=(0,r.EW)((function(){var e=o("firstName",["first_name","firstname"]),t=o("lastName",["last_name","lastname"]),a="".concat(e," ").concat(t).trim();return a||o("username",["name"],"用户")})),c=(0,r.EW)((function(){var e={admin:"管理员",user:"普通用户",viewer:"只读用户"},t=o("role",[]);return e[t]||"用户"})),d=(0,r.EW)((function(){return o("profilePicture",["profile_picture","avatar"],"")})),m=(0,K.Kh)({firstName:"",lastName:"",username:"",email:"",department:""}),f=(0,K.Kh)({currentPassword:"",newPassword:"",confirmPassword:""}),p=(0,K.Kh)({twoFactor:!1,loginNotifications:!0}),v=(0,K.Kh)({vulnerabilities:!0,weeklyReport:!0,systemAnnouncements:!0}),k=(0,K.Kh)({profile:!1,password:!1,avatar:!1}),b={firstName:[{required:!0,message:"请输入名字",trigger:"blur"}],lastName:[{required:!0,message:"请输入姓氏",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度必须在3到20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}]},g={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:function(e,t,a){t!==f.newPassword?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}]},h=function(){i.value&&(console.log("初始化表单数据，用户信息:",i.value),m.firstName=o("firstName",["first_name","firstname"]),m.lastName=o("lastName",["last_name","lastname"]),m.username=o("username",[]),m.email=o("email",[]),m.department=o("department",[]))},w=function(){var t=(0,T.A)((0,R.A)().mark((function t(){var r,n;return(0,R.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a.value){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,a.value.validate();case 5:return k.profile=!0,t.next=8,j.A.put("/api/users/me",{firstName:m.firstName,lastName:m.lastName,department:m.department});case 8:r=t.sent,r.data&&(e.dispatch("auth/updateUserInfo",{first_name:m.firstName,last_name:m.lastName,firstName:m.firstName,lastName:m.lastName,department:m.department}),(0,I.nk)({type:"success",message:"个人信息更新成功"})),t.next=16;break;case 12:t.prev=12,t.t0=t["catch"](2),console.error("更新个人信息失败:",t.t0),(0,I.nk)({type:"error",message:(null===(n=t.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.error)||"更新个人信息失败，请稍后重试"});case 16:return t.prev=16,k.profile=!1,t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[2,12,16,19]])})));return function(){return t.apply(this,arguments)}}(),L=function(){var e=(0,T.A)((0,R.A)().mark((function e(){var t,a;return(0,R.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.value){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,n.value.validate();case 5:return k.password=!0,e.next=8,j.A.put("/api/users/me",{currentPassword:f.currentPassword,newPassword:f.newPassword});case 8:t=e.sent,t.data&&(f.currentPassword="",f.newPassword="",f.confirmPassword="",(0,I.nk)({type:"success",message:"密码修改成功"})),e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](2),console.error("修改密码失败:",e.t0),(0,I.nk)({type:"error",message:(null===(a=e.t0.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.error)||"修改密码失败，请确认当前密码是否正确"});case 16:return e.prev=16,k.password=!1,e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),y=function(){l.value.click()},F=function(){var e=(0,T.A)((0,R.A)().mark((function e(t){var a,r,n,l;return(0,R.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.target.files[0],a){e.next=3;break}return e.abrupt("return");case 3:if(r=a.type.startsWith("image/"),n=2,l=1024*n*1024,r){e.next=9;break}return I.nk.error("请上传图片文件"),e.abrupt("return");case 9:if(!(a.size>l)){e.next=12;break}return I.nk.error("图片大小不能超过".concat(n,"MB")),e.abrupt("return");case 12:(0,I.nk)({type:"info",message:"头像上传功能即将推出，敬请期待！"}),t.target.value="";case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=function(e){if(!e)return"未知";var t=new Date(e);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)},V=function(){B.s.confirm("确定要退出登录吗?","退出确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.dispatch("auth/logout"),t.push("/login"),(0,I.nk)({type:"success",message:"已安全退出系统"})}))["catch"]((function(){}))};return(0,r.sV)((function(){e.dispatch("user/fetchCurrentUser").then((function(){console.log("用户信息已更新"),h()}))["catch"]((function(e){console.error("获取用户信息失败:",e)}))})),{user:i,userFullName:u,userRoleText:c,userAvatar:d,getUserField:o,activeTab:s,profileForm:a,profileData:m,passwordForm:n,passwordData:f,securitySettings:p,notificationSettings:v,loading:k,profileRules:b,passwordRules:g,avatarInput:l,formatDate:_,submitProfileForm:w,submitPasswordForm:L,handleAvatarClick:y,handleAvatarUpload:F,logout:V}}};var $=a(66262);const X=(0,$.A)(M,[["render",C],["__scopeId","data-v-2e14aa73"]]),G=X},60511:(e,t,a)=>{var r=a(60788),n=TypeError;e.exports=function(e){if(r(e))throw new n("The method doesn't accept regular expressions");return e}},60788:(e,t,a)=>{var r=a(20034),n=a(22195),l=a(78227),s=l("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[s])?!!t:"RegExp"===n(e))}}}]);
//# sourceMappingURL=17.5061b744.js.map